import{r as t,j as e,b as U,H as F,L}from"./app-Wz8Xz1sB.js";import{U as R}from"./UserLayout-Drvek5PT.js";import{n as z}from"./Star.es-DPnL6WIS.js";import{n as A}from"./User.es-fTKSiBt1.js";import{L as N}from"./Loading-DB8EKYfD.js";import{n as H}from"./Play.es-Ds3rukho.js";import{u as T}from"./useTranslation-DXkM1PKK.js";import"./Logo-CaXkd6rt.js";import"./IconBase.es-BSU2OHbn.js";import"./MagnifyingGlass.es-nIG-02Wj.js";const B=({onMovieSelect:y,selectedMovie:S,onUserSelect:v,selectedUser:b,placeholder:x="Film veya kullanıcı ara..."})=>{const[j,d]=t.useState(""),[a,n]=t.useState({movies:[],users:[]}),[g,m]=t.useState(!1),i=s=>{if(!s.trim()){n({movies:[],users:[]});return}m(!0),fetch(`/api/search/movies?query=${encodeURIComponent(s)}`).then(l=>l.json()).then(l=>fetch(`/api/search/users?query=${encodeURIComponent(s)}`).then(c=>c.json()).then(c=>{const f={movies:l.results||[],users:c.users||[]};n(f),m(!1)})).catch(l=>{console.error("Search error:",l),n({movies:[],users:[]}),m(!1)})},u=s=>{const l=s.target.value;d(l),l.trim()?i(l):n({movies:[],users:[]})},w=s=>{y(s),n({movies:[],users:[]}),d("")},k=s=>{v(s),n({movies:[],users:[]}),d("")};return e.jsxs("div",{className:"py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:j,onChange:u,placeholder:x,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400"}),g&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(N,{size:"sm"})})]}),(a.movies.length>0||a.users.length>0)&&e.jsxs("div",{className:"mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto",style:{zIndex:9999},children:[a.movies.length>0&&e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"Filmler"}),a.movies.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>w(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${s.poster_path}`,alt:s.title,className:"w-12 h-16 object-cover rounded",onError:l=>{l.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='92' height='138' viewBox='0 0 92 138'%3E%3Crect width='92' height='138' fill='%23cccccc'/%3E%3Ctext x='46' y='69' text-anchor='middle' dy='.3em' fill='%23666666' font-family='Arial' font-size='12'%3ENo Image%3C/text%3E%3C/svg%3E"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.release_date?.split("-")[0]}),s.vote_average&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(z,{className:"w-4 h-4 text-black fill-current"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:s.vote_average.toFixed(1)})]})]})]})},s.id))]}),a.users.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"Kullanıcılar"}),a.users.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>k(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s.profile_photo?e.jsx("img",{src:`/storage/${s.profile_photo}`,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",s.username||s.name?.toLowerCase().replace(/\s+/g,"")]})]})]})},s.id))]})]})]})},X=({auth:y})=>{const{t:S}=T(),{url:v}=U(),[b,x]=t.useState([]),[j,d]=t.useState(!0),[a,n]=t.useState(!1),[g,m]=t.useState(1),[i,u]=t.useState(!0),[w,k]=t.useState(null),[s,l]=t.useState(null);t.useEffect(()=>{c()},[]),t.useEffect(()=>{x([]),m(1),u(!0),c()},[v]);const c=t.useCallback(async(r=1,h=!1)=>{r===1?d(!0):n(!0);try{console.log(`Fetching movies for page: ${r}`);const o=await(await fetch(`/api/movies/popular?page=${r}`)).json();console.log(`Response for page ${r}:`,o),o.movies&&o.movies.length>0?(x(h?M=>{const C=o.movies.filter(_=>!M.some(I=>I.id===_.id));return console.log(`Adding ${C.length} new movies from page ${r}`),[...M,...C]}:o.movies),m(r),u(o.movies.length===20&&r<(o.total_pages||100)),console.log(`Has more: ${o.movies.length===20&&r<(o.total_pages||100)}`)):u(!1)}catch(p){console.error("Film yükleme hatası:",p)}finally{d(!1),n(!1)}},[]),f=t.useCallback(()=>{console.log("loadMore called:",{page:g,loadingMore:a,hasMore:i}),!a&&i&&(console.log("Fetching next page:",g+1),c(g+1,!0))},[g,a,i,c]);t.useEffect(()=>{const r=document.getElementById("scroll-trigger");if(!r||!i||a)return;const h=new IntersectionObserver(p=>{p.forEach(o=>{o.isIntersecting&&(console.log("Trigger element is visible, loading more movies..."),f())})},{root:null,rootMargin:"100px",threshold:.1});return h.observe(r),()=>{h.disconnect()}},[f,i,a]);const E=r=>{k(r),window.location.href=`/users/${r.id}`},$=r=>{l(r),window.location.href=`/movies/${r.id}`};return e.jsxs(R,{auth:y,children:[e.jsx(F,{title:S("discover","Keşfet")}),e.jsxs("div",{className:"w-full",children:[e.jsx(B,{onMovieSelect:$,selectedMovie:s,onUserSelect:E,selectedUser:w}),e.jsx("div",{className:"py-4",children:j?e.jsx(N,{size:"lg",centered:!0}):b.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-0",children:b.map(r=>e.jsx(L,{href:`/movies/${r.id}`,className:"aspect-[2/3] overflow-hidden hover:scale-105 transition-transform duration-200 cursor-pointer",children:e.jsx("img",{src:r.poster_path,alt:r.title,className:"w-full h-full object-cover",onError:h=>{h.target.src="https://via.placeholder.com/200x300/cccccc/666666?text=No+Image"}})},r.id))}),a&&e.jsx("div",{className:"text-center py-4",children:e.jsx(N,{size:"sm"})}),i&&!a&&e.jsx("div",{id:"scroll-trigger",className:"h-1 w-full",style:{marginTop:"100px"}})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(H,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Film bulunamadı"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Şu anda popüler filmler yüklenemiyor."}),e.jsx("button",{onClick:()=>c(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Tekrar Dene"})]})})]})]})};export{X as default};
