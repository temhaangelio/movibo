import{r,j as e,b as F,H as L,L as U}from"./app-CUfu8rYq.js";import{U as z}from"./UserLayout-D_QpIzUd.js";import{n as I}from"./Star.es-BlTDokYj.js";import{n as H}from"./User.es-U7lSCGfk.js";import{L as S}from"./Loading-DtTTuKj4.js";import{n as R}from"./Play.es-Bc9hvUQP.js";import{u as T}from"./useTranslation-D0fAQNgG.js";import"./Logo-BXGbrpuT.js";import"./IconBase.es-CzJ_fMgf.js";import"./MagnifyingGlass.es-CoT4O1zZ.js";const A=({onMovieSelect:y,selectedMovie:p,onUserSelect:v,selectedUser:c,placeholder:h="Film veya kullanÄ±cÄ± ara..."})=>{const[b,d]=r.useState(""),[l,o]=r.useState({movies:[],users:[]}),[x,m]=r.useState(!1),g=s=>{if(!s.trim()){o({movies:[],users:[]});return}m(!0),fetch(`/api/search/movies?query=${encodeURIComponent(s)}`).then(a=>a.json()).then(a=>fetch(`/api/search/users?query=${encodeURIComponent(s)}`).then(n=>n.json()).then(n=>{const f={movies:a.results||[],users:n.users||[]};o(f),m(!1)})).catch(a=>{console.error("Search error:",a),o({movies:[],users:[]}),m(!1)})},u=s=>{const a=s.target.value;d(a),a.trim()?g(a):o({movies:[],users:[]})},j=s=>{y(s),o({movies:[],users:[]}),d("")},k=s=>{v(s),o({movies:[],users:[]}),d("")};return e.jsxs("div",{className:"py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b,onChange:u,placeholder:h,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400"}),x&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(S,{size:"sm"})})]}),(l.movies.length>0||l.users.length>0)&&e.jsxs("div",{className:"mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto",style:{zIndex:9999},children:[l.movies.length>0&&e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"Filmler"}),l.movies.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>j(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${s.poster_path}`,alt:s.title,className:"w-12 h-16 object-cover rounded",onError:a=>{a.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='92' height='138' viewBox='0 0 92 138'%3E%3Crect width='92' height='138' fill='%23cccccc'/%3E%3Ctext x='46' y='69' text-anchor='middle' dy='.3em' fill='%23666666' font-family='Arial' font-size='12'%3ENo Image%3C/text%3E%3C/svg%3E"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.release_date?.split("-")[0]}),s.vote_average&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(I,{className:"w-4 h-4 text-black fill-current"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:s.vote_average.toFixed(1)})]})]})]})},s.id))]}),l.users.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"KullanÄ±cÄ±lar"}),l.users.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>k(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s.profile_photo?e.jsx("img",{src:`/storage/${s.profile_photo}`,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",s.username||s.name?.toLowerCase().replace(/\s+/g,"")]})]})]})},s.id))]})]})]})},V=({auth:y})=>{const{t:p}=T(),{url:v}=F(),[c,h]=r.useState([]),[b,d]=r.useState(!0),[l,o]=r.useState(!1),[x,m]=r.useState(1),[g,u]=r.useState(!0),[j,k]=r.useState(null),[s,a]=r.useState(null);r.useEffect(()=>{n()},[]),r.useEffect(()=>{h([]),m(1),u(!0),n()},[v]);const n=async(t=1,w=!1)=>{t===1?d(!0):o(!0);try{console.log(`Fetching movies for page: ${t}`);const i=await(await fetch(`/api/movies/popular?page=${t}`)).json();if(console.log(`Response for page ${t}:`,i),i.movies&&i.movies.length>0){if(w){const C=i.movies.filter(N=>!c.some(_=>_.id===N.id));console.log(`Adding ${C.length} new movies from page ${t}`),h(N=>[...N,...C])}else h(i.movies);m(t),u(i.movies.length===20&&t<(i.total_pages||100)),console.log(`Has more: ${i.movies.length===20&&t<(i.total_pages||100)}`)}else u(!1)}catch(E){console.error("Film yÃ¼kleme hatasÄ±:",E)}finally{d(!1),o(!1)}},f=r.useCallback(()=>{!l&&g&&n(x+1,!0)},[x,l,g]);r.useEffect(()=>{const t=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-1e3&&f()};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[f]);const $=t=>{k(t),window.location.href=`/users/${t.id}`},M=t=>{a(t),window.location.href=`/movies/${t.id}`};return e.jsxs(z,{auth:y,children:[e.jsx(L,{title:p("discover","KeÅŸfet")}),e.jsxs("div",{className:"w-full",children:[e.jsx(A,{onMovieSelect:M,selectedMovie:s,onUserSelect:$,selectedUser:j}),e.jsx("div",{className:"py-4",children:b?e.jsx("div",{className:"text-center py-12",children:e.jsx(S,{size:"lg",showText:!0,text:p("loading_movies","Filmler yÃ¼kleniyor...")})}):c.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-0",children:c.map(t=>e.jsx(U,{href:`/movies/${t.id}`,className:"aspect-[2/3] overflow-hidden hover:scale-105 transition-transform duration-200 cursor-pointer",children:e.jsx("img",{src:t.poster_path,alt:t.title,className:"w-full h-full object-cover",onError:w=>{w.target.src="https://via.placeholder.com/200x300/cccccc/666666?text=No+Image"}})},t.id))}),g&&e.jsx("div",{className:"text-center py-8",children:l?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(S,{size:"sm",showText:!1}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Daha fazla film yÃ¼kleniyor..."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:f,className:"px-6 py-3 bg-gray-900 dark:bg-gray-700 text-white rounded-lg hover:bg-gray-800 dark:hover:bg-gray-600 transition-colors font-medium",children:"Daha Fazla Film YÃ¼kle"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Sayfa ",x," - ",c.length," ","film yÃ¼klendi"]})]})}),!g&&c.length>0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"TÃ¼m filmler yÃ¼klendi! ðŸŽ¬"})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(R,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Film bulunamadÄ±"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Åžu anda popÃ¼ler filmler yÃ¼klenemiyor."}),e.jsx("button",{onClick:()=>n(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Tekrar Dene"})]})})]})]})};export{V as default};
