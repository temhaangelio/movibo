import{r as s,j as e,u as $,L as _}from"./app-1CFGegWC.js";import{T as O}from"./TimeAgo-aeiYudVu.js";import{C as D}from"./Confirm-B68scm7X.js";import{n as P}from"./Trash.es-C5et1ok0.js";import{n as Y}from"./User.es-DyCkQSaU.js";import{B as U}from"./Buton-D5AuJqn0.js";import{A as H}from"./Alert-DEbxkOPg.js";import{L as B,n as F}from"./UserLayout-BdK1clx9.js";import{s as K}from"./ChatCircle.es-DsYPXDwK.js";import{p as z}from"./IconBase.es-CROb1i5a.js";import{n as X}from"./Heart.es-BEp-LZMX.js";import{u as V}from"./useTranslation-B6O3CaGH.js";const G=new Map([["bold",s.createElement(s.Fragment,null,s.createElement("path",{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"}))],["duotone",s.createElement(s.Fragment,null,s.createElement("path",{d:"M240,96v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V96A16,16,0,0,1,32,80H224A16,16,0,0,1,240,96Z",opacity:"0.2"}),s.createElement("path",{d:"M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,196,116ZM60,116a12,12,0,1,0,12,12A12,12,0,0,0,60,116Z"}))],["fill",s.createElement(s.Fragment,null,s.createElement("path",{d:"M224,80H32A16,16,0,0,0,16,96v64a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V96A16,16,0,0,0,224,80ZM60,140a12,12,0,1,1,12-12A12,12,0,0,1,60,140Zm68,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm68,0a12,12,0,1,1,12-12A12,12,0,0,1,196,140Z"}))],["light",s.createElement(s.Fragment,null,s.createElement("path",{d:"M138,128a10,10,0,1,1-10-10A10,10,0,0,1,138,128ZM60,118a10,10,0,1,0,10,10A10,10,0,0,0,60,118Zm136,0a10,10,0,1,0,10,10A10,10,0,0,0,196,118Z"}))],["regular",s.createElement(s.Fragment,null,s.createElement("path",{d:"M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,196,116ZM60,116a12,12,0,1,0,12,12A12,12,0,0,0,60,116Z"}))],["thin",s.createElement(s.Fragment,null,s.createElement("path",{d:"M136,128a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-76-8a8,8,0,1,0,8,8A8,8,0,0,0,60,120Zm136,0a8,8,0,1,0,8,8A8,8,0,0,0,196,120Z"}))]]),J=new Map([["bold",s.createElement(s.Fragment,null,s.createElement("path",{d:"M230.14,25.86a20,20,0,0,0-19.57-5.11l-.22.07L18.44,79a20,20,0,0,0-3.06,37.25L99,157l40.71,83.65a19.81,19.81,0,0,0,18,11.38c.57,0,1.15,0,1.73-.07A19.82,19.82,0,0,0,177,237.56L235.18,45.65a1.42,1.42,0,0,0,.07-.22A20,20,0,0,0,230.14,25.86ZM156.91,221.07l-34.37-70.64,46-45.95a12,12,0,0,0-17-17l-46,46L34.93,99.09,210,46Z"}))],["duotone",s.createElement(s.Fragment,null,s.createElement("path",{d:"M223.69,42.18l-58.22,192a8,8,0,0,1-14.92,1.25L108,148,20.58,105.45a8,8,0,0,1,1.25-14.92l192-58.22A8,8,0,0,1,223.69,42.18Z",opacity:"0.2"}),s.createElement("path",{d:"M227.32,28.68a16,16,0,0,0-15.66-4.08l-.15,0L19.57,82.84a16,16,0,0,0-2.49,29.8L102,154l41.3,84.87A15.86,15.86,0,0,0,157.74,248q.69,0,1.38-.06a15.88,15.88,0,0,0,14-11.51l58.2-191.94c0-.05,0-.1,0-.15A16,16,0,0,0,227.32,28.68ZM157.83,231.85l-.05.14,0-.07-40.06-82.3,48-48a8,8,0,0,0-11.31-11.31l-48,48L24.08,98.25l-.07,0,.14,0L216,40Z"}))],["fill",s.createElement(s.Fragment,null,s.createElement("path",{d:"M231.4,44.34s0,.1,0,.15l-58.2,191.94a15.88,15.88,0,0,1-14,11.51q-.69.06-1.38.06a15.86,15.86,0,0,1-14.42-9.15L107,164.15a4,4,0,0,1,.77-4.58l57.92-57.92a8,8,0,0,0-11.31-11.31L96.43,148.26a4,4,0,0,1-4.58.77L17.08,112.64a16,16,0,0,1,2.49-29.8l191.94-58.2.15,0A16,16,0,0,1,231.4,44.34Z"}))],["light",s.createElement(s.Fragment,null,s.createElement("path",{d:"M225.88,30.12a13.83,13.83,0,0,0-13.7-3.58l-.11,0L20.14,84.77A14,14,0,0,0,18,110.85l85.56,41.64L145.12,238a13.87,13.87,0,0,0,12.61,8c.4,0,.81,0,1.21-.05a13.9,13.9,0,0,0,12.29-10.09l58.2-191.93,0-.11A13.83,13.83,0,0,0,225.88,30.12Zm-8,10.4L159.73,232.43l0,.11a2,2,0,0,1-3.76.26l-40.68-83.58,49-49a6,6,0,1,0-8.49-8.49l-49,49L23.15,100a2,2,0,0,1,.31-3.74l.11,0L215.48,38.08a1.94,1.94,0,0,1,1.92.52A2,2,0,0,1,217.92,40.52Z"}))],["regular",s.createElement(s.Fragment,null,s.createElement("path",{d:"M227.32,28.68a16,16,0,0,0-15.66-4.08l-.15,0L19.57,82.84a16,16,0,0,0-2.49,29.8L102,154l41.3,84.87A15.86,15.86,0,0,0,157.74,248q.69,0,1.38-.06a15.88,15.88,0,0,0,14-11.51l58.2-191.94c0-.05,0-.1,0-.15A16,16,0,0,0,227.32,28.68ZM157.83,231.85l-.05.14,0-.07-40.06-82.3,48-48a8,8,0,0,0-11.31-11.31l-48,48L24.08,98.25l-.07,0,.14,0L216,40Z"}))],["thin",s.createElement(s.Fragment,null,s.createElement("path",{d:"M224.47,31.52a11.87,11.87,0,0,0-11.82-3L20.74,86.67a12,12,0,0,0-1.91,22.38L105,151l41.92,86.15A11.88,11.88,0,0,0,157.74,244c.34,0,.69,0,1,0a11.89,11.89,0,0,0,10.52-8.63l58.21-192,0-.08A11.85,11.85,0,0,0,224.47,31.52Zm-4.62,9.54-58.23,192a4,4,0,0,1-7.48.59l-41.3-84.86,50-50a4,4,0,1,0-5.66-5.66l-50,50-84.9-41.31a3.88,3.88,0,0,1-2.27-4,3.93,3.93,0,0,1,3-3.54L214.9,36.16A3.93,3.93,0,0,1,216,36a4,4,0,0,1,2.79,1.19A3.93,3.93,0,0,1,219.85,41.06Z"}))]]),R=s.forwardRef((t,f)=>s.createElement(z,{ref:f,...t,weights:G}));R.displayName="DotsThreeIcon";const Q=R,q=s.forwardRef((t,f)=>s.createElement(z,{ref:f,...t,weights:J}));q.displayName="PaperPlaneTiltIcon";const W=q,ee=(t,f=2)=>!t||typeof t!="string"?"":t.toLowerCase().trim().split(/\s+/).map(l=>l.length>0?l.charAt(0).toUpperCase():"").filter(l=>l.length>0).slice(0,f).join(""),te=t=>ee(t,2),se=({open:t,onClose:f,post:n,user:j})=>{const[m,l]=s.useState([]),[c,b]=s.useState(""),[d,w]=s.useState(!1),[C,A]=s.useState(!1),[S,u]=s.useState(!1),[N,h]=s.useState(""),[v,x]=s.useState(!1),[g,E]=s.useState(null),L=async()=>{if(n){w(!0);try{const i=await(await fetch(`/api/posts/${n.id}/comments`,{credentials:"same-origin"})).json();l(i.comments)}catch(r){console.error("Yorumlar yüklenirken hata:",r),h("Yorumlar yüklenirken bir hata oluştu."),u(!0)}finally{w(!1)}}},Z=async r=>{if(r.preventDefault(),!!c.trim()){A(!0);try{const i=document.querySelector('meta[name="csrf-token"]'),k=i?i.getAttribute("content"):"",a=await fetch("/comments",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k},credentials:"same-origin",body:JSON.stringify({post_id:n.id,content:c.trim()})}),o=await a.json();a.ok?(l(p=>[o.comment,...p]),b(""),n.onCommentCountUpdate&&n.onCommentCountUpdate(o.comments_count)):(h("Yorum eklenirken bir hata oluştu."),u(!0))}catch(i){console.error("Yorum eklenirken hata:",i),h("Yorum eklenirken bir hata oluştu."),u(!0)}finally{A(!1)}}},M=r=>{E(r),x(!0)},T=async()=>{if(g)try{const r=document.querySelector('meta[name="csrf-token"]'),i=r?r.getAttribute("content"):"",k=await fetch(`/comments/${g}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":i},credentials:"same-origin"});if(k.ok){l(o=>o.filter(p=>p.id!==g));const a=await k.json();n.onCommentCountUpdate&&n.onCommentCountUpdate(a.comments_count)}else h("Yorum silinirken bir hata oluştu."),u(!0)}catch(r){console.error("Yorum silinirken hata:",r),h("Yorum silinirken bir hata oluştu."),u(!0)}finally{E(null),x(!1)}};return s.useEffect(()=>{t&&n&&L()},[t,n]),t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-gray-100 bg-gray-50",children:[e.jsx("div",{className:"max-h-64 overflow-y-auto p-4",children:d?e.jsx("div",{className:"text-center py-4",children:e.jsx(B,{size:"sm"})}):m.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Henüz yorum yok."})}):e.jsx("div",{className:"space-y-3",children:m.map(r=>e.jsxs("div",{className:"flex space-x-3 border-b border-gray-200 pb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center",children:r.user?.name?e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:r.user.name.split(" ").map(i=>i.charAt(0)).join("").toUpperCase().slice(0,2)}):e.jsx(Y,{className:"w-3 h-3 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-xs text-gray-900",children:r.user?.name}),e.jsx("span",{className:"text-xs text-gray-500",children:e.jsx(O,{date:r.created_at})})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:r.content})]}),j&&r.user_id===j.id&&e.jsx("button",{onClick:()=>M(r.id),className:"text-gray-500 hover:text-red-500 transition-colors p-1 rounded",title:"Yorumu Sil",children:e.jsx(P,{className:"w-3 h-3"})})]},r.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("form",{onSubmit:Z,className:"space-y-3",children:[e.jsx("textarea",{value:c,onChange:r=>{const i=r.target.value;i.length<=250&&b(i)},placeholder:"Yorumunuzu yazın...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:2,maxLength:250}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:`text-xs ${c.length>200?"text-red-500":"text-gray-500"}`,children:[c.length,"/250"]}),e.jsx(U,{type:"submit",disabled:C||!c.trim(),size:"sm",children:C?"Gönderiliyor...":"Gönder"})]})]})})]}),e.jsx(H,{open:S,type:"error",message:N,onClose:()=>u(!1)}),e.jsx(D,{open:v,onClose:()=>{x(!1),E(null)},onConfirm:T,title:"Yorumu Sil",message:"Bu yorumu silmek istediğinizden emin misiniz?",confirmText:"Sil",cancelText:"Vazgeç"})]}):null},fe=({post:t,onComment:f,user:n,onDelete:j,onLike:m=()=>{}})=>{const{t:l}=V(),[c,b]=s.useState(t.is_liked||!1),[d,w]=s.useState(t.likes_count||0),[C,A]=s.useState(!1),[S,u]=s.useState(!1),[N,h]=s.useState(!1),[v,x]=s.useState(!1),g=s.useRef(null),{delete:E,processing:L}=$(),{processing:Z}=$();s.useEffect(()=>{const a=o=>{g.current&&!g.current.contains(o.target)&&x(!1)};return v&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[v]),s.useEffect(()=>{n&&t.user&&n.id!==t.user.id&&t.user.username&&fetch(`/users/${t.user.username}/follow/check`).then(a=>a.json()).then(a=>{A(a.isFollowing)}).catch(a=>{console.error("Follow check error:",a)})},[n,t.user]);const M=async()=>{if(!(!n||!t.user||n.id===t.user.id||!t.user.username))try{const o=await(await fetch(`/users/${t.user.username}/follow`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();o.success&&A(o.isFollowing)}catch{}},T=()=>{const a=!c,o=c?d-1:d+1;b(a),w(o),m&&m(t.id,a,o);const p=document.querySelector('meta[name="csrf-token"]'),I=p?p.getAttribute("content"):"";fetch(`/posts/${t.id}/like`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":I},credentials:"same-origin"}).then(y=>y.json()).then(y=>{b(y.liked),w(y.count),m&&m(t.id,y.liked,y.count)}).catch(y=>{b(!a),w(a?d+1:d-1),m&&m(t.id,!a,a?d+1:d-1)})},r=async()=>{const a={title:`${t.user?.name} - ${t.media_title}`,text:t.content||`${t.media_title} hakkında yorum yaptı`,url:`${window.location.origin}/posts/${t.id}`};try{navigator.share?await navigator.share(a):await navigator.clipboard.writeText(a.url)}catch{try{await navigator.clipboard.writeText(a.url)}catch{}}},i=()=>{u(!0)},k=()=>{E(`/posts/${t.id}`,{onSuccess:()=>{j&&j(t.id)},onError:a=>{alert(l("delete_error","Paylaşım silinirken bir hata oluştu."))}})};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center p-3",children:[e.jsxs(_,{href:t.user?.username?`/users/${t.user.username}`:`/users/${t.user_id}`,className:"flex items-center",children:[t.user?.profile_photo?e.jsx("img",{src:`/storage/${t.user.profile_photo}`,alt:t.user.name,className:"w-10 h-10 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity",onError:a=>{a.target.style.display="none",a.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:`w-10 h-10 bg-black rounded-full flex items-center justify-center cursor-pointer transition-colors ${t.user?.profile_photo?"hidden":""}`,children:t.user?.name?e.jsx("span",{className:"text-sm font-semibold text-white",children:te(t.user.name)}):e.jsx(Y,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx(_,{href:t.user?.username?`/users/${t.user.username}`:`/users/${t.user_id}`,className:"block",children:e.jsx("p",{className:"font-medium text-gray-900 hover:text-blue-600 transition-colors cursor-pointer",children:t.user?.name})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(O,{date:t.created_at})})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n&&t.user&&n.id!==t.user.id&&e.jsx("button",{onClick:M,className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 ${C?"bg-red-50 border border-red-200 text-red-600 hover:bg-red-100":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow-md"}`,children:C?"Takibi Bırak":"Takip Et"}),e.jsxs("div",{className:"relative",ref:g,children:[e.jsx("button",{onClick:()=>x(!v),className:"p-2 text-gray-500 hover:text-gray-900 transition-colors rounded-full hover:bg-gray-100",children:e.jsx(Q,{className:"w-5 h-5"})}),v&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{r(),x(!1)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(W,{className:"w-4 h-4 mr-3"}),l("share_post")]}),n&&t.user_id===n.id&&e.jsxs("button",{onClick:()=>{i(),x(!1)},disabled:L,className:"w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50",children:[e.jsx(P,{className:"w-4 h-4 mr-3"}),l("delete_post")]})]})})]})]})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(_,{href:`/movies/${t.media_id}`,children:e.jsx("h3",{className:"font-semibold text-gray-900 text-lg mb-2 hover:text-blue-600 transition-colors cursor-pointer",children:t.media_title})}),t.media_poster&&e.jsxs("div",{className:"relative",children:[e.jsx(_,{href:`/movies/${t.media_id}`,children:e.jsx("img",{src:t.media_poster,alt:t.media_title,className:"w-full h-48 object-cover rounded-lg shadow-lg cursor-pointer hover:scale-105 transition-transform",onError:a=>{a.target.style.display="none"}})}),t.media_rating&&e.jsx("div",{className:"absolute top-2 right-2 bg-black/70 backdrop-blur-sm px-2 py-1 rounded-full",children:e.jsxs("span",{className:"flex items-center text-sm",children:[e.jsx(F,{className:"w-4 h-4 text-white mr-1",weight:"fill"}),e.jsx("span",{className:"text-white",children:t.media_rating})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsx("span",{className:"text-sm font-medium",children:t.media_release_date?.split("-")[0]}),(t.user_rating||t.user_rating===0)&&e.jsxs("span",{className:"flex items-center text-sm bg-black/70 px-2 py-1 rounded-full",children:[e.jsx(F,{className:"w-3 h-3 text-white mr-1",weight:"fill"}),t.user_rating,"/5",e.jsx("span",{className:"ml-1 text-xs opacity-90",children:l("my_rating")})]})]})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.content})})]}),e.jsx("div",{className:"flex items-center justify-between px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:T,disabled:Z,className:"flex items-center space-x-2 text-gray-500 hover:text-gray-900 transition-colors disabled:opacity-50",children:[e.jsx(X,{className:`w-5 h-5 ${c?"text-red-500":""}`,weight:c?"fill":"regular"}),e.jsx("span",{className:"text-sm font-medium",children:d})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center space-x-2 text-gray-500 hover:text-gray-900 transition-colors",children:[e.jsx(K,{className:`w-5 h-5 ${N?"text-gray-900":""}`,weight:N?"fill":"regular"}),e.jsx("span",{className:"text-sm font-medium",children:t.comments_count||0})]})]})}),e.jsx(D,{open:S,onClose:()=>u(!1),onConfirm:k,title:l("delete_post"),message:l("delete_post_confirm"),confirmText:l("delete"),cancelText:l("cancel")}),N&&e.jsx(se,{open:N,onClose:()=>h(!1),post:t,user:n})]})};export{fe as P,te as g};
