import{b as O,r as l,j as e,H as q,L as G}from"./app-1CFGegWC.js";import{U as J,L as N,n as V}from"./UserLayout-BdK1clx9.js";import{m as W}from"./FlyingSaucer.es-CV1AxamM.js";import{n as X}from"./User.es-DyCkQSaU.js";import{u as Y}from"./useTranslation-B6O3CaGH.js";import"./Logo-Bs4F9_8V.js";import"./IconBase.es-CROb1i5a.js";import"./MagnifyingGlass.es-B-Qxmdvq.js";import"./Buton-D5AuJqn0.js";const ne=({auth:E})=>{const{t:w}=Y(),{url:U}=O(),[S,u]=l.useState([]),[I,M]=l.useState(!0),[o,$]=l.useState(!1),[g,_]=l.useState(1),[n,v]=l.useState(!0),[C,F]=l.useState(null),[L,R]=l.useState(null),z=({onMovieSelect:t,selectedMovie:c,onUserSelect:i,selectedUser:r,placeholder:f="Film veya kullanıcı ara...",className:p=""})=>{const[j,h]=l.useState(""),[d,m]=l.useState({movies:[],users:[]}),[P,y]=l.useState(!1),T=s=>{if(!s.trim()){m({movies:[],users:[]});return}y(!0),fetch(`/api/search/movies?query=${encodeURIComponent(s)}`).then(a=>a.json()).then(a=>fetch(`/api/search/users?query=${encodeURIComponent(s)}`).then(b=>b.json()).then(b=>{const D={movies:a.results||[],users:b.users||[]};m(D),y(!1)})).catch(a=>{console.error("Search error:",a),m({movies:[],users:[]}),y(!1)})},K=s=>{const a=s.target.value;h(a),a.trim()?T(a):m({movies:[],users:[]})},Q=s=>{t(s),m({movies:[],users:[]}),h("")},B=s=>{i(s),m({movies:[],users:[]}),h("")};return e.jsxs("div",{className:`relative ${p}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:j,onChange:K,placeholder:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),P&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(N,{size:"sm"})})]}),(d.movies.length>0||d.users.length>0)&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:[d.movies.length>0&&e.jsxs("div",{className:"border-b border-gray-100",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Filmler"}),d.movies.slice(0,3).map(s=>e.jsx("button",{type:"button",onClick:()=>Q(s),className:"w-full p-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${s.poster_path}`,alt:s.title,className:"w-12 h-16 object-cover rounded",onError:a=>{a.target.src="https://via.placeholder.com/92x138?text=No+Image"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s.release_date?.split("-")[0]}),s.vote_average&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(V,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:s.vote_average.toFixed(1)})]})]})]})},s.id))]}),d.users.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Kullanıcılar"}),d.users.slice(0,3).map(s=>e.jsx("button",{type:"button",onClick:()=>B(s),className:"w-full p-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s.profile_photo?e.jsx("img",{src:`/storage/${s.profile_photo}`,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-gray-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 truncate",children:["@",s.username||s.name?.toLowerCase().replace(/\s+/g,"")]})]})]})},s.id))]})]})]})};l.useEffect(()=>{x()},[]),l.useEffect(()=>{u([]),_(1),v(!0),x()},[U]);const x=l.useCallback(async(t=1,c=!1)=>{t===1?M(!0):$(!0);try{console.log(`Fetching movies for page: ${t}`);const r=await(await fetch(`/api/movies/popular?page=${t}`)).json();console.log(`Response for page ${t}:`,r),r.success&&r.movies&&r.movies.length>0?(u(c?f=>{const p=r.movies.filter(j=>!f.some(h=>h.id===j.id));return console.log(`Adding ${p.length} new movies from page ${t}`),[...f,...p]}:r.movies),_(t),v(r.movies.length===20&&t<(r.total_pages||100)),console.log(`Has more: ${r.movies.length===20&&t<(r.total_pages||100)}`)):(v(!1),r.success||console.error("API Error:",r.message))}catch(i){console.error("Film yükleme hatası:",i),u([])}finally{M(!1),$(!1)}},[]),k=l.useCallback(()=>{console.log("loadMore called:",{page:g,loadingMore:o,hasMore:n}),!o&&n&&(console.log("Fetching next page:",g+1),x(g+1,!0))},[g,o,n,x]);l.useEffect(()=>{const t=document.getElementById("scroll-trigger");if(!t||!n||o)return;const c=new IntersectionObserver(i=>{i.forEach(r=>{r.isIntersecting&&(console.log("Trigger element is visible, loading more movies..."),k())})},{root:null,rootMargin:"100px",threshold:.1});return c.observe(t),()=>{c.disconnect()}},[k,n,o]);const H=t=>{F(t),window.location.href=`/users/${t.id}`},A=t=>{R(t),window.location.href=`/movies/${t.id}`};return e.jsxs(J,{auth:E,children:[e.jsx(q,{title:w("discover","Keşfet")}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"py-4 border-b border-gray-200",children:e.jsx(z,{onMovieSelect:A,selectedMovie:L,onUserSelect:H,selectedUser:C,placeholder:"Film veya kullanıcı ara..."})}),e.jsx("div",{className:"py-4",children:I?e.jsx(N,{size:"lg",centered:!0}):S.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-0",children:S.map(t=>e.jsx(G,{href:`/movies/${t.id}`,className:"aspect-[2/3] overflow-hidden hover:scale-105 transition-transform duration-200 cursor-pointer",children:e.jsx("img",{src:t.poster_path,alt:t.title,className:"w-full h-full object-cover",onError:c=>{c.target.src="https://via.placeholder.com/200x300/cccccc/666666?text=No+Image"}})},t.id))}),o&&e.jsx("div",{className:"text-center py-4",children:e.jsx(N,{size:"sm"})}),n&&!o&&e.jsx("div",{id:"scroll-trigger",className:"h-1 w-full",style:{marginTop:"100px"}})]}):e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-48 text-center w-full",children:[e.jsx(W,{className:"w-24 h-24"}),e.jsx("h3",{className:"text-lg font-medium  mb-2",children:w("no_content_yet","Henüz bir içerik yok!")})]})})})]})]})};export{ne as default};
