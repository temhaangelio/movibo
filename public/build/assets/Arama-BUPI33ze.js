import{r,j as e,b as L,H as U,L as F}from"./app-CnN1zPhp.js";import{U as I}from"./UserLayout-DKu7ohCp.js";import{n as H}from"./Star.es-BklqYOp8.js";import{n as R}from"./User.es-CdCXxLwo.js";import{L as N}from"./Loading-BlPTnSvb.js";import{n as z}from"./Play.es-Hxz1rHDR.js";import{u as A}from"./useTranslation-vd9agBZR.js";import"./Logo-B-HAfOs3.js";import"./IconBase.es-DBDioL27.js";import"./MagnifyingGlass.es-NAktjeb2.js";const T=({onMovieSelect:p,selectedMovie:S,onUserSelect:y,selectedUser:h,placeholder:m="Film veya kullanıcı ara..."})=>{const[v,i]=r.useState(""),[l,o]=r.useState({movies:[],users:[]}),[x,d]=r.useState(!1),u=s=>{if(!s.trim()){o({movies:[],users:[]});return}d(!0),fetch(`/api/search/movies?query=${encodeURIComponent(s)}`).then(a=>a.json()).then(a=>fetch(`/api/search/users?query=${encodeURIComponent(s)}`).then(c=>c.json()).then(c=>{const f={movies:a.results||[],users:c.users||[]};o(f),d(!1)})).catch(a=>{console.error("Search error:",a),o({movies:[],users:[]}),d(!1)})},g=s=>{const a=s.target.value;i(a),a.trim()?u(a):o({movies:[],users:[]})},b=s=>{p(s),o({movies:[],users:[]}),i("")},j=s=>{y(s),o({movies:[],users:[]}),i("")};return e.jsxs("div",{className:"py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v,onChange:g,placeholder:m,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400"}),x&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(N,{size:"sm"})})]}),(l.movies.length>0||l.users.length>0)&&e.jsxs("div",{className:"mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto",style:{zIndex:9999},children:[l.movies.length>0&&e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-600",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"Filmler"}),l.movies.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>b(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${s.poster_path}`,alt:s.title,className:"w-12 h-16 object-cover rounded",onError:a=>{a.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='92' height='138' viewBox='0 0 92 138'%3E%3Crect width='92' height='138' fill='%23cccccc'/%3E%3Ctext x='46' y='69' text-anchor='middle' dy='.3em' fill='%23666666' font-family='Arial' font-size='12'%3ENo Image%3C/text%3E%3C/svg%3E"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.release_date?.split("-")[0]}),s.vote_average&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(H,{className:"w-4 h-4 text-black fill-current"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:s.vote_average.toFixed(1)})]})]})]})},s.id))]}),l.users.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"Kullanıcılar"}),l.users.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:()=>j(s),className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s.profile_photo?e.jsx("img",{src:`/storage/${s.profile_photo}`,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:["@",s.username||s.name?.toLowerCase().replace(/\s+/g,"")]})]})]})},s.id))]})]})]})},W=({auth:p})=>{const{t:S}=A(),{url:y}=L(),[h,m]=r.useState([]),[v,i]=r.useState(!0),[l,o]=r.useState(!1),[x,d]=r.useState(1),[u,g]=r.useState(!0),[b,j]=r.useState(null),[s,a]=r.useState(null);r.useEffect(()=>{c()},[]),r.useEffect(()=>{m([]),d(1),g(!0),c()},[y]);const c=async(t=1,w=!1)=>{t===1?i(!0):o(!0);try{console.log(`Fetching movies for page: ${t}`);const n=await(await fetch(`/api/movies/popular?page=${t}`)).json();if(console.log(`Response for page ${t}:`,n),n.movies&&n.movies.length>0){if(w){const $=n.movies.filter(k=>!h.some(_=>_.id===k.id));console.log(`Adding ${$.length} new movies from page ${t}`),m(k=>[...k,...$])}else m(n.movies);d(t),g(n.movies.length===20&&t<(n.total_pages||100)),console.log(`Has more: ${n.movies.length===20&&t<(n.total_pages||100)}`)}else g(!1)}catch(E){console.error("Film yükleme hatası:",E)}finally{i(!1),o(!1)}},f=r.useCallback(()=>{!l&&u&&c(x+1,!0)},[x,l,u]);r.useEffect(()=>{const t=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-1e3&&f()};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[f]);const C=t=>{j(t),window.location.href=`/users/${t.id}`},M=t=>{a(t),window.location.href=`/movies/${t.id}`};return e.jsxs(I,{auth:p,children:[e.jsx(U,{title:S("discover","Keşfet")}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{onMovieSelect:M,selectedMovie:s,onUserSelect:C,selectedUser:b}),e.jsx("div",{className:"py-4",children:v?e.jsx("div",{className:"text-center py-12",children:e.jsx(N,{size:"lg"})}):h.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-0",children:h.map(t=>e.jsx(F,{href:`/movies/${t.id}`,className:"aspect-[2/3] overflow-hidden hover:scale-105 transition-transform duration-200 cursor-pointer",children:e.jsx("img",{src:t.poster_path,alt:t.title,className:"w-full h-full object-cover",onError:w=>{w.target.src="https://via.placeholder.com/200x300/cccccc/666666?text=No+Image"}})},t.id))}),l&&e.jsx("div",{className:"text-center py-4",children:e.jsx(N,{size:"sm"})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Film bulunamadı"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Şu anda popüler filmler yüklenemiyor."}),e.jsx("button",{onClick:()=>c(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Tekrar Dene"})]})})]})]})};export{W as default};
